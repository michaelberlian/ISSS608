---
title: "DataViz Makeover"
date: "21 January 2024"
date-modified: "last-modified"
execute: 
  eval: true
  echo: true
  warning: false
editor: visual
---

## Overview

in this take home exercise, I will make over take-home exercise 1 of my classmate. I will try to improve his figures.

## Getting started

### Loading packages

we are going to use several packages beforehand.

```{r}
pacman::p_load(tidyverse, haven, patchwork)
```

### Importing dataset

we are going to use the same dataset of student questionnaire, we are going to follow the steps;

1.  Importing the data in sas data type

```{r}
#| eval: false
stu_qqq <- read_sas('data/cy08msp_stu_qqq.sas7bdat')
```

2.  Filtering the data to singapore

```{r}
#| eval: false
stu_qqq_SG <- stu_qqq %>%
  filter(CNT == "SGP")
```

3.  Export the filtered dataset to rds to ease further data importing

```{r}
#| eval: false
write_rds(stu_qqq_SG, 'data/stu_qqq_SG.rds')
```

4.  Read the exported rds

```{r}
stu_qqq_SG <- read_rds('data/stu_qqq_SG.rds')
```

### Data preparation and wrangling

#### Data preparation

-   Filtering the columns that will be used for further analysis, in this analysis we are going to take 6 variables, they are:

    -   CNTSCHID = school_id

    -   ST004D01T = gender

    -   math = average of 10 math possible values

    -   science = average of 10 science possible values

    -   read = average of 10 reading possible values

    -   ESCS = social economic

-   Rename the columns to a more understandable names

-   Recode the answers of questions to a more descriptive measures

-   Change the columns data type

```{r}
stu_qqq <- stu_qqq_SG %>%
  mutate(math = rowMeans(select(stu_qqq_SG,
         PV1MATH,PV2MATH,PV3MATH,PV4MATH,PV5MATH,PV6MATH,PV7MATH,PV8MATH,PV9MATH,PV10MATH)),
         science = rowMeans(select(stu_qqq_SG,
         PV1SCIE,PV2SCIE,PV3SCIE,PV4SCIE,PV5SCIE,PV6SCIE,PV7SCIE,PV8SCIE,PV9SCIE,PV10SCIE)),
         read = rowMeans(select(stu_qqq_SG,
         PV1READ,PV2READ,PV3READ,PV4READ,PV5READ,PV6READ,PV7READ,PV8READ,PV9READ,PV10READ))
         ) %>%
  select(CNTSCHID,ST004D01T,math,science,read,ESCS) %>%
  rename(c(school_ID = "CNTSCHID", 
           gender = "ST004D01T",
           socio_economic = "ESCS")) %>%
  mutate(gender = recode(gender, 
                         "1" = "Female", 
                         "2" = "Male"))

stu_qqq$school_ID <- as.factor(stu_qqq$school_ID)
stu_qqq$gender <- as.factor(stu_qqq$gender)
```

```{r}
glimpse(stu_qqq)
```

## Visualisation Makeover

### 1. Distribution of student's performance in each subject

![](images/Screenshot 2024-01-23 at 15.07.27.png)

the goal of the above plot is to show the median, mean, and distribution of the student performances across the subjects.

I believe the plot above can be improved, such as:

-   the x axis could be more clearer, instead of putting the subject as a title, the subject can be put before the "score" at x axis

```{=html}
<!-- -->
```
-   the mean line color is very similar as the bar color resulting in blended colour between both, therefore the color could be changed

-   we cannot really know the score for the median and mean, adding the score to the label using annotation could give additional information

-   the minimal space of using patchwork got worse since histogram is used, the figure above gives false impression of reading to be more important with a bigger graph than science and math. this might be caused by having 3 vertical histogram side by side would make each graphs too squeezed. I propose to change the orientation of the graph and make them side by side to reduce the inclarity of the graph.

```{r}
summary(stu_qqq$math)
summary(stu_qqq$science)
summary(stu_qqq$read)
```

```{r}
stat1_mean <- mean(stu_qqq$math)
stat1_median <- median(stu_qqq$math)

stat2_mean <- mean(stu_qqq$science)
stat2_median <- median(stu_qqq$science)

stat3_mean <- mean(stu_qqq$read)
stat3_median <- median(stu_qqq$read)

p1 <- ggplot(data = stu_qqq,
       aes(x = math)) +
  geom_histogram(binwidth = 50,
                 color = 'grey50',
                 fill = 'grey90') +
  stat_bin(binwidth = 50,
           geom = "text",
           aes(label=after_stat(count)), 
           vjust = .35,
           hjust = .75,
           size = 2.5,
           color = 'black') +
  geom_vline(mapping = aes(xintercept=stat1_mean),
             color = "red",
             linetype = 'dashed') +
  geom_vline(mapping = aes(xintercept=stat1_median),
             color = "blue",
             linetype = 'dashed') +
  annotate(
    'text',
    x = stat1_mean - 20,
    y = 500,
    label = paste0("Mean = ", round(stat1_mean,2)),
    color = "red"
  ) +
  annotate(
    'text',
    x = stat1_median + 20,
    y = 550,
    label = paste0("Median = ", round(stat1_median,2)),
    color = "blue"
  ) +
  scale_x_continuous("Math Scores", limits = c(150,850), breaks = seq(150,850,50)) +
  scale_y_continuous("Frequency", breaks = seq(0,1300,200)) +
  theme(panel.background = element_rect(fill="white",colour="white"),
        panel.grid.major = element_line(color = "grey80"),
        panel.grid.minor = element_blank(),
        panel.grid.major.y = element_blank()) +
  coord_flip() 

p2 <- ggplot(data = stu_qqq,
       aes(x = science)) +
  geom_histogram(binwidth = 50,
                 color = 'grey50',
                 fill = 'grey90') +
  stat_bin(binwidth = 50,
           geom = "text",
           aes(label=after_stat(count)), 
           vjust = .35,
           hjust = .75,
           size = 2.5,
           color = 'black') +
  geom_vline(mapping = aes(xintercept=stat2_mean),
             color = "red",
             linetype = 'dashed') +
  geom_vline(mapping = aes(xintercept=stat2_median),
             color = "blue",
             linetype = 'dashed') +
  annotate(
    'text',
    x = stat2_mean - 20,
    y = 500,
    label = paste0("Mean = ", round(stat2_mean,2)),
    color = "red"
  ) +
  annotate(
    'text',
    x = stat2_median + 20,
    y = 550,
    label = paste0("Median = ", round(stat2_median,2)),
    color = "blue"
  ) +
  scale_x_continuous("Science Scores", limits = c(150,850), breaks = seq(150,850,50)) +
  scale_y_continuous("Frequency", breaks = seq(0,1300,200)) +
  theme(panel.background = element_rect(fill="white",colour="white"),
        panel.grid.major = element_line(color = "grey80"),
        panel.grid.minor = element_blank(),
        panel.grid.major.y = element_blank()) +
  coord_flip() 

p3 <- ggplot(data = stu_qqq,
       aes(x = read)) +
  geom_histogram(binwidth = 50,
                 color = 'grey50',
                 fill = 'grey90') +
  stat_bin(binwidth = 50,
           geom = "text",
           aes(label=after_stat(count)), 
           vjust = .35,
           hjust = .75,
           size = 2.5,
           color = 'black') +
  geom_vline(mapping = aes(xintercept=stat3_mean),
             color = "red",
             linetype = 'dashed') +
  geom_vline(mapping = aes(xintercept=stat3_median),
             color = "blue",
             linetype = 'dashed') +
  annotate(
    'text',
    x = stat3_mean - 20,
    y = 500,
    label = paste0("Mean = ", round(stat3_mean,2)),
    color = "red"
  ) +
  annotate(
    'text',
    x = stat3_median + 20,
    y = 550,
    label = paste0("Median = ", round(stat3_median,2)),
    color = "blue"
  ) +
  scale_x_continuous("Reading Scores", limits = c(150,850), breaks = seq(150,850,50)) +
  scale_y_continuous("Frequency", breaks = seq(0,1300,200)) +
  theme(panel.background = element_rect(fill="white",colour="white"),
        panel.grid.major = element_line(color = "grey80"),
        panel.grid.minor = element_blank(),
        panel.grid.major.y = element_blank()) +
  coord_flip() 

p1 | p2 | p3
```

### 2. Student's academic performances in relation to gender

![](images/Screenshot 2024-01-23 at 15.10.11.png)

the plot above was used to show the studend performance differences between gender across the subject

there are ways to improve the plot, such as:

-   give different colors toward each subject

-   a clearer and more attractive title

-   giving the error bar on the box plot to give better view

-   give the legends of the plot

-   create more y tick to ease reading each of the box plot attributes

    ```{r}
    gendermath <- ggplot(data = stu_qqq,
           aes(x = gender,
               y = math)) +
      geom_boxplot(color = c("pink",'lightblue')) +
      stat_boxplot(geom = "errorbar", 
                   width = 0.25,
                   color = c("pink",'lightblue'))+
      geom_point(stat = "summary",        
                 fun.y = "mean",           
                 colour = "green",          
                 size = 1) +
      labs(x = "Math's Score") +
      scale_y_continuous("Frequency", breaks = seq(150,850,50), limits = c(150,850))+
        theme(panel.background = element_rect(fill="white",colour="white"),
              panel.grid.major = element_line(color = "grey80"),
              panel.grid.minor = element_blank(),
              panel.grid.major.x = element_blank())

    genderread <- ggplot(data = stu_qqq,
           aes(x = gender,
               y = read)) +
      geom_boxplot(color = c("pink",'lightblue')) +
      stat_boxplot(geom = "errorbar", 
                   width = 0.25,
                   color = c("pink",'lightblue'))+
      geom_point(stat = "summary",        
                 fun.y = "mean",           
                 colour = "green",          
                 size = 1) +
      ylim(150,850) +
      labs(x = "Reading's Score") +
      scale_y_continuous(NULL,breaks = seq(150,850,50), limits = c(150,850))+
        theme(panel.background = element_rect(fill="white",colour="white"),
              panel.grid.major = element_line(color = "grey80"),
              panel.grid.minor = element_blank(),
              panel.grid.major.x = element_blank())

    gendersci <- ggplot(data = stu_qqq,
           aes(x = gender,
               y = science)) +
      geom_boxplot(color = c("pink",'lightblue')) +
      stat_boxplot(geom = "errorbar", 
                   width = 0.25,
                   color = c("pink",'lightblue'))+
      geom_point(stat = "summary",        
                 fun.y = "mean",           
                 colour = "green",          
                 size = 1) +
      ylim(150,850) +
      labs(x = "Science's Score") +
      scale_y_continuous(NULL,breaks = seq(150,850,50), limits = c(150,850))+
        theme(panel.background = element_rect(fill="white",colour="white"),
              panel.grid.major = element_line(color = "grey80"),
              panel.grid.minor = element_blank(),
              panel.grid.major.x = element_blank())

    gendermath + genderread + gendersci + plot_annotation(
      title = 'Student\'s Performance across Subjects between Genders',
      theme = theme(plot.title = element_text(hjust = 0.5))
    )
    ```

### 3. The comparison of student's performances between schools

#### 3.1 distribution of average performances

![](images/Screenshot 2024-01-23 at 15.10.30.png)

#### 3.2 distribution of average performances compared to Singapore average

![](images/Screenshot 2024-01-23 at 15.10.48.png)

### 4. Student's performance in regards to their household's socioeconomic status

![](images/Screenshot 2024-01-23 at 15.12.23.png)
